{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/priyanshkakkad/Downloads/investment-platform-design/lib/db/mongoose.ts"],"sourcesContent":["import mongoose from \"mongoose\"\n\nconst MONGODB_URI = process.env.MONGODB_URI\n\nif (!MONGODB_URI) {\n  throw new Error(\"Please define the MONGODB_URI environment variable\")\n}\n\nlet cached = (global as any).mongoose\n\nif (!cached) {\n  cached = (global as any).mongoose = { conn: null, promise: null }\n}\n\nexport async function connectDB() {\n  if (cached.conn) {\n    return cached.conn\n  }\n\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n    }\n\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\n      return mongoose\n    })\n  }\n\n  try {\n    cached.conn = await cached.promise\n  } catch (e) {\n    cached.promise = null\n    throw e\n  }\n\n  return cached.conn\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MAAM;AAClB;AAEA,IAAI,SAAS,yDAAgB,QAAQ;AAErC,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAgB,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAClE;AAEO,eAAe;IACpB,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB"}},
    {"offset": {"line": 87, "column": 0}, "map": {"version":3,"sources":["file:///Users/priyanshkakkad/Downloads/investment-platform-design/lib/models/Document.ts"],"sourcesContent":["import mongoose, { Schema, type Document } from \"mongoose\"\nimport type { IDocument } from \"../types\"\n\ninterface DocumentDocument extends Document, IDocument {}\n\nconst documentSchema = new Schema<DocumentDocument>(\n  {\n    businessId: {\n      type: Schema.Types.ObjectId,\n      ref: \"Business\",\n      required: true,\n    },\n    fileName: {\n      type: String,\n      required: true,\n    },\n    fileUrl: {\n      type: String,\n      required: true,\n    },\n    documentType: {\n      type: String,\n      required: true,\n    },\n    uploadedAt: {\n      type: Date,\n      default: Date.now,\n    },\n    verified: {\n      type: Boolean,\n      default: false,\n    },\n    verifiedBy: {\n      type: Schema.Types.ObjectId,\n      ref: \"User\",\n      default: null,\n    },\n    verifiedAt: {\n      type: Date,\n      default: null,\n    },\n  },\n  {\n    timestamps: false, // Only use uploadedAt\n  },\n)\n\n// Index for business documents\ndocumentSchema.index({ businessId: 1 })\n\nexport const DocumentModel = mongoose.models.Document || mongoose.model<DocumentDocument>(\"Document\", documentSchema)\n"],"names":[],"mappings":";;;;AAAA;;AAKA,MAAM,iBAAiB,IAAI,mHAAM,CAC/B;IACE,YAAY;QACV,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,UAAU;QACR,MAAM;QACN,UAAU;IACZ;IACA,SAAS;QACP,MAAM;QACN,UAAU;IACZ;IACA,cAAc;QACZ,MAAM;QACN,UAAU;IACZ;IACA,YAAY;QACV,MAAM;QACN,SAAS,KAAK,GAAG;IACnB;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;IACA,YAAY;QACV,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,SAAS;IACX;IACA,YAAY;QACV,MAAM;QACN,SAAS;IACX;AACF,GACA;IACE,YAAY;AACd;AAGF,+BAA+B;AAC/B,eAAe,KAAK,CAAC;IAAE,YAAY;AAAE;AAE9B,MAAM,gBAAgB,oHAAQ,CAAC,MAAM,CAAC,QAAQ,IAAI,oHAAQ,CAAC,KAAK,CAAmB,YAAY"}},
    {"offset": {"line": 140, "column": 0}, "map": {"version":3,"sources":["file:///Users/priyanshkakkad/Downloads/investment-platform-design/lib/models/Business.ts"],"sourcesContent":["import mongoose, { Schema, type Document } from \"mongoose\"\nimport type { IBusiness } from \"../types\"\n\ninterface BusinessDocument extends Document, IBusiness {}\n\nconst businessSchema = new Schema<BusinessDocument>(\n  {\n    ownerId: {\n      type: Schema.Types.ObjectId,\n      ref: \"User\",\n      required: true,\n    },\n    name: {\n      type: String,\n      required: true,\n    },\n    description: {\n      type: String,\n      required: true,\n    },\n    category: {\n      type: String,\n      default: null,\n    },\n    latitude: {\n      type: Number,\n      required: true,\n    },\n    longitude: {\n      type: Number,\n      required: true,\n    },\n    status: {\n      type: String,\n      enum: [\"pending\", \"under_review\", \"verified\", \"approved\", \"rejected\"],\n      default: \"pending\",\n      required: true,\n    },\n    minInvestmentAmount: {\n      type: Number,\n      required: true,\n      min: 0,\n    },\n    maxInvestmentAmount: {\n      type: Number,\n      required: true,\n      min: 0,\n    },\n    expectedReturnPercentage: {\n      type: Number,\n      default: null,\n    },\n    documents: {\n      type: [Schema.Types.ObjectId],\n      ref: \"Document\",\n      default: [],\n    },\n    monthlyRevenue: {\n      type: Number,\n      default: null,\n    },\n    profitMargin: {\n      type: Number,\n      default: null,\n    },\n    growthPercentage: {\n      type: Number,\n      default: null,\n    },\n    customerCount: {\n      type: Number,\n      default: null,\n    },\n  },\n  {\n    timestamps: true,\n  },\n)\n\n// Indexes for performance\nbusinessSchema.index({ ownerId: 1 })\nbusinessSchema.index({ status: 1 })\nbusinessSchema.index({ createdAt: -1 })\n\nexport const Business = mongoose.models.Business || mongoose.model<BusinessDocument>(\"Business\", businessSchema)\n"],"names":[],"mappings":";;;;AAAA;;AAKA,MAAM,iBAAiB,IAAI,mHAAM,CAC/B;IACE,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,MAAM;QACJ,MAAM;QACN,UAAU;IACZ;IACA,aAAa;QACX,MAAM;QACN,UAAU;IACZ;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;IACA,UAAU;QACR,MAAM;QACN,UAAU;IACZ;IACA,WAAW;QACT,MAAM;QACN,UAAU;IACZ;IACA,QAAQ;QACN,MAAM;QACN,MAAM;YAAC;YAAW;YAAgB;YAAY;YAAY;SAAW;QACrE,SAAS;QACT,UAAU;IACZ;IACA,qBAAqB;QACnB,MAAM;QACN,UAAU;QACV,KAAK;IACP;IACA,qBAAqB;QACnB,MAAM;QACN,UAAU;QACV,KAAK;IACP;IACA,0BAA0B;QACxB,MAAM;QACN,SAAS;IACX;IACA,WAAW;QACT,MAAM;YAAC,mHAAM,CAAC,KAAK,CAAC,QAAQ;SAAC;QAC7B,KAAK;QACL,SAAS,EAAE;IACb;IACA,gBAAgB;QACd,MAAM;QACN,SAAS;IACX;IACA,cAAc;QACZ,MAAM;QACN,SAAS;IACX;IACA,kBAAkB;QAChB,MAAM;QACN,SAAS;IACX;IACA,eAAe;QACb,MAAM;QACN,SAAS;IACX;AACF,GACA;IACE,YAAY;AACd;AAGF,0BAA0B;AAC1B,eAAe,KAAK,CAAC;IAAE,SAAS;AAAE;AAClC,eAAe,KAAK,CAAC;IAAE,QAAQ;AAAE;AACjC,eAAe,KAAK,CAAC;IAAE,WAAW,CAAC;AAAE;AAE9B,MAAM,WAAW,oHAAQ,CAAC,MAAM,CAAC,QAAQ,IAAI,oHAAQ,CAAC,KAAK,CAAmB,YAAY"}},
    {"offset": {"line": 239, "column": 0}, "map": {"version":3,"sources":["file:///Users/priyanshkakkad/Downloads/investment-platform-design/lib/models/BusinessVisibility.ts"],"sourcesContent":["import mongoose, { Schema, type Document } from \"mongoose\"\nimport type { IBusinessVisibility } from \"../types\"\n\ninterface BusinessVisibilityDocument extends Document, IBusinessVisibility {}\n\nconst businessVisibilitySchema = new Schema<BusinessVisibilityDocument>(\n  {\n    investorId: {\n      type: Schema.Types.ObjectId,\n      ref: \"User\",\n      required: true,\n    },\n    businessId: {\n      type: Schema.Types.ObjectId,\n      ref: \"Business\",\n      required: true,\n    },\n    createdAt: {\n      type: Date,\n      default: Date.now,\n    },\n  },\n  {\n    timestamps: false, // Only use createdAt\n  },\n)\n\n// Composite index to prevent duplicate visibility assignments\nbusinessVisibilitySchema.index({ investorId: 1, businessId: 1 }, { unique: true })\n\nexport const BusinessVisibility =\n  mongoose.models.BusinessVisibility ||\n  mongoose.model<BusinessVisibilityDocument>(\"BusinessVisibility\", businessVisibilitySchema)\n"],"names":[],"mappings":";;;;AAAA;;AAKA,MAAM,2BAA2B,IAAI,mHAAM,CACzC;IACE,YAAY;QACV,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,YAAY;QACV,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,WAAW;QACT,MAAM;QACN,SAAS,KAAK,GAAG;IACnB;AACF,GACA;IACE,YAAY;AACd;AAGF,8DAA8D;AAC9D,yBAAyB,KAAK,CAAC;IAAE,YAAY;IAAG,YAAY;AAAE,GAAG;IAAE,QAAQ;AAAK;AAEzE,MAAM,qBACX,oHAAQ,CAAC,MAAM,CAAC,kBAAkB,IAClC,oHAAQ,CAAC,KAAK,CAA6B,sBAAsB"}},
    {"offset": {"line": 341, "column": 0}, "map": {"version":3,"sources":["file:///Users/priyanshkakkad/Downloads/investment-platform-design/lib/models/User.ts"],"sourcesContent":["import mongoose, { Schema, type Document } from \"mongoose\"\nimport type { IUser } from \"../types\"\n\ninterface UserDocument extends Document, IUser {}\n\nconst userSchema = new Schema<UserDocument>(\n  {\n    name: {\n      type: String,\n      required: true,\n    },\n    email: {\n      type: String,\n      required: true,\n      unique: true,\n      lowercase: true,\n      match: /^\\S+@\\S+\\.\\S+$/,\n    },\n    passwordHash: {\n      type: String,\n      required: true,\n      select: false, // Don't return password hash by default\n    },\n    role: {\n      type: String,\n      enum: [\"admin\", \"business_owner\", \"investor\"],\n      default: \"investor\",\n      required: true,\n    },\n    isActive: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  {\n    timestamps: true,\n  },\n)\n\n// Indexes for performance\nuserSchema.index({ email: 1 })\nuserSchema.index({ role: 1 })\nuserSchema.index({ isActive: 1 })\n\nexport const User = mongoose.models.User || mongoose.model<UserDocument>(\"User\", userSchema)\n"],"names":[],"mappings":";;;;AAAA;;AAKA,MAAM,aAAa,IAAI,mHAAM,CAC3B;IACE,MAAM;QACJ,MAAM;QACN,UAAU;IACZ;IACA,OAAO;QACL,MAAM;QACN,UAAU;QACV,QAAQ;QACR,WAAW;QACX,OAAO;IACT;IACA,cAAc;QACZ,MAAM;QACN,UAAU;QACV,QAAQ;IACV;IACA,MAAM;QACJ,MAAM;QACN,MAAM;YAAC;YAAS;YAAkB;SAAW;QAC7C,SAAS;QACT,UAAU;IACZ;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;AACF,GACA;IACE,YAAY;AACd;AAGF,0BAA0B;AAC1B,WAAW,KAAK,CAAC;IAAE,OAAO;AAAE;AAC5B,WAAW,KAAK,CAAC;IAAE,MAAM;AAAE;AAC3B,WAAW,KAAK,CAAC;IAAE,UAAU;AAAE;AAExB,MAAM,OAAO,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAe,QAAQ"}},
    {"offset": {"line": 396, "column": 0}, "map": {"version":3,"sources":["file:///Users/priyanshkakkad/Downloads/investment-platform-design/lib/db/auth.ts"],"sourcesContent":["import bcrypt from \"bcryptjs\"\nimport { User } from \"../models/User\"\nimport { connectDB } from \"./mongoose\"\nimport type { SessionUser } from \"../types\"\n\n/**\n * Hash password for secure storage\n */\nexport async function hashPassword(password: string): Promise<string> {\n  const salt = await bcrypt.genSalt(10)\n  return bcrypt.hash(password, salt)\n}\n\n/**\n * Compare password with hash\n */\nexport async function verifyPassword(password: string, hash: string): Promise<boolean> {\n  return bcrypt.compare(password, hash)\n}\n\n/**\n * Find user by email\n */\nexport async function findUserByEmail(email: string): Promise<any> {\n  await connectDB()\n  const user = await User.findOne({ email: email.toLowerCase() }).select(\"+passwordHash\")\n  return user ? user.toObject() : null\n}\n\n/**\n * Get user session data (without password)\n */\nexport async function getUserSession(userId: string): Promise<SessionUser | null> {\n  await connectDB()\n  const user = await User.findById(userId)\n  if (!user) return null\n\n  return {\n    id: user._id.toString(),\n    email: user.email,\n    name: user.name,\n    role: user.role,\n  }\n}\n\n/**\n * Create a new user (Admin only)\n */\nexport async function createUser(\n  name: string,\n  email: string,\n  password: string,\n  role: \"admin\" | \"business_owner\" | \"investor\",\n): Promise<any> {\n  await connectDB()\n\n  const existingUser = await User.findOne({ email: email.toLowerCase() })\n  if (existingUser) {\n    throw new Error(\"User with this email already exists\")\n  }\n\n  const passwordHash = await hashPassword(password)\n\n  const user = await User.create({\n    name,\n    email: email.toLowerCase(),\n    passwordHash,\n    role,\n  })\n\n  return {\n    _id: user._id.toString(),\n    name: user.name,\n    email: user.email,\n    role: user.role,\n    isActive: user.isActive,\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;AACA;;;;AAMO,eAAe,aAAa,QAAgB;IACjD,MAAM,OAAO,MAAM,mMAAM,CAAC,OAAO,CAAC;IAClC,OAAO,mMAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAKO,eAAe,eAAe,QAAgB,EAAE,IAAY;IACjE,OAAO,mMAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAKO,eAAe,gBAAgB,KAAa;IACjD,MAAM,IAAA,oIAAS;IACf,MAAM,OAAO,MAAM,+HAAI,CAAC,OAAO,CAAC;QAAE,OAAO,MAAM,WAAW;IAAG,GAAG,MAAM,CAAC;IACvE,OAAO,OAAO,KAAK,QAAQ,KAAK;AAClC;AAKO,eAAe,eAAe,MAAc;IACjD,MAAM,IAAA,oIAAS;IACf,MAAM,OAAO,MAAM,+HAAI,CAAC,QAAQ,CAAC;IACjC,IAAI,CAAC,MAAM,OAAO;IAElB,OAAO;QACL,IAAI,KAAK,GAAG,CAAC,QAAQ;QACrB,OAAO,KAAK,KAAK;QACjB,MAAM,KAAK,IAAI;QACf,MAAM,KAAK,IAAI;IACjB;AACF;AAKO,eAAe,WACpB,IAAY,EACZ,KAAa,EACb,QAAgB,EAChB,IAA6C;IAE7C,MAAM,IAAA,oIAAS;IAEf,MAAM,eAAe,MAAM,+HAAI,CAAC,OAAO,CAAC;QAAE,OAAO,MAAM,WAAW;IAAG;IACrE,IAAI,cAAc;QAChB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,eAAe,MAAM,aAAa;IAExC,MAAM,OAAO,MAAM,+HAAI,CAAC,MAAM,CAAC;QAC7B;QACA,OAAO,MAAM,WAAW;QACxB;QACA;IACF;IAEA,OAAO;QACL,KAAK,KAAK,GAAG,CAAC,QAAQ;QACtB,MAAM,KAAK,IAAI;QACf,OAAO,KAAK,KAAK;QACjB,MAAM,KAAK,IAAI;QACf,UAAU,KAAK,QAAQ;IACzB;AACF"}},
    {"offset": {"line": 466, "column": 0}, "map": {"version":3,"sources":["file:///Users/priyanshkakkad/Downloads/investment-platform-design/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import NextAuth, { type NextAuthOptions } from \"next-auth\"\nimport CredentialsProvider from \"next-auth/providers/credentials\"\nimport { connectDB } from \"@/lib/db/mongoose\"\nimport { findUserByEmail, verifyPassword } from \"@/lib/db/auth\"\n\nexport const authOptions: NextAuthOptions = {\n  providers: [\n    CredentialsProvider({\n      name: \"Credentials\",\n      credentials: {\n        email: { label: \"Email\", type: \"email\", placeholder: \"user@example.com\" },\n        password: { label: \"Password\", type: \"password\" },\n      },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) {\n          throw new Error(\"Invalid credentials\")\n        }\n\n        try {\n          await connectDB()\n\n          // Find user by email\n          const user = await findUserByEmail(credentials.email)\n          if (!user) {\n            throw new Error(\"Invalid email or password\")\n          }\n\n          // Check if user is active\n          if (!user.isActive) {\n            throw new Error(\"User account is deactivated\")\n          }\n\n          // Verify password\n          const isValid = await verifyPassword(credentials.password, user.passwordHash)\n          if (!isValid) {\n            throw new Error(\"Invalid email or password\")\n          }\n\n          // Return user object for session\n          return {\n            id: user._id.toString(),\n            email: user.email,\n            name: user.name,\n            role: user.role,\n          }\n        } catch (error) {\n          throw new Error(error instanceof Error ? error.message : \"Authentication failed\")\n        }\n      },\n    }),\n  ],\n  callbacks: {\n    async jwt({ token, user }) {\n      // On login, add user data to token\n      if (user) {\n        token.id = user.id\n        token.role = (user as any).role\n        token.name = user.name\n      }\n      return token\n    },\n    async session({ session, token }) {\n      // Add token data to session\n      if (session.user) {\n        session.user = {\n          id: token.id as string,\n          email: token.email || \"\",\n          name: token.name as string,\n          role: token.role as any,\n        }\n      }\n      return session\n    },\n  },\n  pages: {\n    signIn: \"/login\",\n    error: \"/login\",\n  },\n  secret: process.env.NEXTAUTH_SECRET,\n  session: {\n    strategy: \"jwt\",\n    maxAge: 30 * 24 * 60 * 60, // 30 days\n  },\n}\n\nconst handler = NextAuth(authOptions)\nexport { handler as GET, handler as POST }\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;;;;;AAEO,MAAM,cAA+B;IAC1C,WAAW;QACT,IAAA,uXAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;oBAAS,aAAa;gBAAmB;gBACxE,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;oBACjD,MAAM,IAAI,MAAM;gBAClB;gBAEA,IAAI;oBACF,MAAM,IAAA,oIAAS;oBAEf,qBAAqB;oBACrB,MAAM,OAAO,MAAM,IAAA,sIAAe,EAAC,YAAY,KAAK;oBACpD,IAAI,CAAC,MAAM;wBACT,MAAM,IAAI,MAAM;oBAClB;oBAEA,0BAA0B;oBAC1B,IAAI,CAAC,KAAK,QAAQ,EAAE;wBAClB,MAAM,IAAI,MAAM;oBAClB;oBAEA,kBAAkB;oBAClB,MAAM,UAAU,MAAM,IAAA,qIAAc,EAAC,YAAY,QAAQ,EAAE,KAAK,YAAY;oBAC5E,IAAI,CAAC,SAAS;wBACZ,MAAM,IAAI,MAAM;oBAClB;oBAEA,iCAAiC;oBACjC,OAAO;wBACL,IAAI,KAAK,GAAG,CAAC,QAAQ;wBACrB,OAAO,KAAK,KAAK;wBACjB,MAAM,KAAK,IAAI;wBACf,MAAM,KAAK,IAAI;oBACjB;gBACF,EAAE,OAAO,OAAO;oBACd,MAAM,IAAI,MAAM,iBAAiB,QAAQ,MAAM,OAAO,GAAG;gBAC3D;YACF;QACF;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,mCAAmC;YACnC,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,IAAI,GAAG,AAAC,KAAa,IAAI;gBAC/B,MAAM,IAAI,GAAG,KAAK,IAAI;YACxB;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,4BAA4B;YAC5B,IAAI,QAAQ,IAAI,EAAE;gBAChB,QAAQ,IAAI,GAAG;oBACb,IAAI,MAAM,EAAE;oBACZ,OAAO,MAAM,KAAK,IAAI;oBACtB,MAAM,MAAM,IAAI;oBAChB,MAAM,MAAM,IAAI;gBAClB;YACF;YACA,OAAO;QACT;IACF;IACA,OAAO;QACL,QAAQ;QACR,OAAO;IACT;IACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACnC,SAAS;QACP,UAAU;QACV,QAAQ,KAAK,KAAK,KAAK;IACzB;AACF;AAEA,MAAM,UAAU,IAAA,oWAAQ,EAAC"}},
    {"offset": {"line": 569, "column": 0}, "map": {"version":3,"sources":["file:///Users/priyanshkakkad/Downloads/investment-platform-design/lib/middleware/auth.ts"],"sourcesContent":["import { getServerSession } from \"next-auth/next\"\nimport { authOptions } from \"@/app/api/auth/[...nextauth]/route\"\nimport type { SessionUser, UserRole } from \"../types\"\n\n/**\n * Get current session user\n */\nexport async function getSessionUser(): Promise<SessionUser | null> {\n  const session = await getServerSession(authOptions)\n  return session?.user as SessionUser | null\n}\n\n/**\n * Check if user has required role\n */\nexport async function requireRole(requiredRoles: UserRole | UserRole[]): Promise<{\n  user: SessionUser | null\n  authorized: boolean\n}> {\n  const user = await getSessionUser()\n  if (!user) {\n    return { user: null, authorized: false }\n  }\n\n  const roles = Array.isArray(requiredRoles) ? requiredRoles : [requiredRoles]\n  const authorized = roles.includes(user.role)\n\n  return { user, authorized }\n}\n\n/**\n * Verify owner of resource\n */\nexport function isOwner(userId: string, ownerId: string): boolean {\n  return userId === ownerId\n}\n\n/**\n * Check if user is admin\n */\nexport async function isAdmin(): Promise<boolean> {\n  const { authorized } = await requireRole(\"admin\")\n  return authorized\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAMO,eAAe;IACpB,MAAM,UAAU,MAAM,IAAA,qXAAgB,EAAC,kKAAW;IAClD,OAAO,SAAS;AAClB;AAKO,eAAe,YAAY,aAAoC;IAIpE,MAAM,OAAO,MAAM;IACnB,IAAI,CAAC,MAAM;QACT,OAAO;YAAE,MAAM;YAAM,YAAY;QAAM;IACzC;IAEA,MAAM,QAAQ,MAAM,OAAO,CAAC,iBAAiB,gBAAgB;QAAC;KAAc;IAC5E,MAAM,aAAa,MAAM,QAAQ,CAAC,KAAK,IAAI;IAE3C,OAAO;QAAE;QAAM;IAAW;AAC5B;AAKO,SAAS,QAAQ,MAAc,EAAE,OAAe;IACrD,OAAO,WAAW;AACpB;AAKO,eAAe;IACpB,MAAM,EAAE,UAAU,EAAE,GAAG,MAAM,YAAY;IACzC,OAAO;AACT"}},
    {"offset": {"line": 615, "column": 0}, "map": {"version":3,"sources":["file:///Users/priyanshkakkad/Downloads/investment-platform-design/lib/utils/response.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\n\nexport interface ApiResponse<T = any> {\n  success: boolean\n  data?: T\n  error?: string\n  message?: string\n}\n\n/**\n * Success response\n */\nexport function successResponse<T>(data: T, statusCode = 200): NextResponse<ApiResponse<T>> {\n  return NextResponse.json({ success: true, data }, { status: statusCode })\n}\n\n/**\n * Error response\n */\nexport function errorResponse(error: string, statusCode = 400): NextResponse<ApiResponse> {\n  return NextResponse.json({ success: false, error }, { status: statusCode })\n}\n\n/**\n * Unauthorized response\n */\nexport function unauthorizedResponse(): NextResponse<ApiResponse> {\n  return NextResponse.json({ success: false, error: \"Unauthorized\" }, { status: 401 })\n}\n\n/**\n * Forbidden response\n */\nexport function forbiddenResponse(): NextResponse<ApiResponse> {\n  return NextResponse.json({ success: false, error: \"Forbidden\" }, { status: 403 })\n}\n\n/**\n * Not found response\n */\nexport function notFoundResponse(): NextResponse<ApiResponse> {\n  return NextResponse.json({ success: false, error: \"Not found\" }, { status: 404 })\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;AAYO,SAAS,gBAAmB,IAAO,EAAE,aAAa,GAAG;IAC1D,OAAO,+QAAY,CAAC,IAAI,CAAC;QAAE,SAAS;QAAM;IAAK,GAAG;QAAE,QAAQ;IAAW;AACzE;AAKO,SAAS,cAAc,KAAa,EAAE,aAAa,GAAG;IAC3D,OAAO,+QAAY,CAAC,IAAI,CAAC;QAAE,SAAS;QAAO;IAAM,GAAG;QAAE,QAAQ;IAAW;AAC3E;AAKO,SAAS;IACd,OAAO,+QAAY,CAAC,IAAI,CAAC;QAAE,SAAS;QAAO,OAAO;IAAe,GAAG;QAAE,QAAQ;IAAI;AACpF;AAKO,SAAS;IACd,OAAO,+QAAY,CAAC,IAAI,CAAC;QAAE,SAAS;QAAO,OAAO;IAAY,GAAG;QAAE,QAAQ;IAAI;AACjF;AAKO,SAAS;IACd,OAAO,+QAAY,CAAC,IAAI,CAAC;QAAE,SAAS;QAAO,OAAO;IAAY,GAAG;QAAE,QAAQ;IAAI;AACjF"}},
    {"offset": {"line": 673, "column": 0}, "map": {"version":3,"sources":["file:///Users/priyanshkakkad/Downloads/investment-platform-design/app/api/businesses/%5Bid%5D/documents/route.ts"],"sourcesContent":["import { connectDB } from \"@/lib/db/mongoose\"\nimport { DocumentModel } from \"@/lib/models/Document\"\nimport { Business } from \"@/lib/models/Business\"\nimport { BusinessVisibility } from \"@/lib/models/BusinessVisibility\"\nimport { getSessionUser, isOwner } from \"@/lib/middleware/auth\"\nimport {\n  successResponse,\n  errorResponse,\n  unauthorizedResponse,\n  notFoundResponse,\n  forbiddenResponse,\n} from \"@/lib/utils/response\"\n\n// GET - List documents for a business\nexport async function GET(request: Request, { params }: { params: Promise<{ id: string }> }) {\n  try {\n    const user = await getSessionUser()\n    if (!user) {\n      return unauthorizedResponse()\n    }\n\n    const { id } = await params\n    await connectDB()\n\n    const business = await Business.findById(id)\n    if (!business) {\n      return notFoundResponse()\n    }\n\n    // Authorization: owner, admin, or assigned investor\n    if (user.role === \"business_owner\") {\n      if (!isOwner(user.id, business.ownerId.toString())) {\n        return forbiddenResponse()\n      }\n    } else if (user.role === \"investor\") {\n      if (business.status !== \"approved\") {\n        return forbiddenResponse()\n      }\n\n      const visibility = await BusinessVisibility.findOne({\n        investorId: user.id,\n        businessId: id,\n      })\n\n      if (!visibility) {\n        return forbiddenResponse()\n      }\n    }\n    // Admins can see all documents\n\n    const documents = await DocumentModel.find({ businessId: id })\n\n    return successResponse(documents)\n  } catch (error) {\n    console.error(\"Get documents error:\", error)\n    return errorResponse(\"Failed to fetch documents\", 500)\n  }\n}\n\n// POST - Upload document (owner only)\nexport async function POST(request: Request, { params }: { params: Promise<{ id: string }> }) {\n  try {\n    const user = await getSessionUser()\n    if (!user) {\n      return unauthorizedResponse()\n    }\n\n    const { id } = await params\n    await connectDB()\n\n    const business = await Business.findById(id)\n    if (!business) {\n      return notFoundResponse()\n    }\n\n    if (user.role !== \"business_owner\" || !isOwner(user.id, business.ownerId.toString())) {\n      return forbiddenResponse()\n    }\n\n    const formData = await request.formData()\n    const file = formData.get(\"file\") as File\n    const documentType = formData.get(\"documentType\") as string\n\n    if (!file || !documentType) {\n      return errorResponse(\"Missing required fields\", 400)\n    }\n\n    const bytes = await file.arrayBuffer()\n    const buffer = Buffer.from(bytes)\n    const fs = await import(\"fs/promises\")\n    const path = await import(\"path\")\n    \n    const uploadDir = path.join(process.cwd(), \"public\", \"uploads\")\n    await fs.mkdir(uploadDir, { recursive: true })\n    \n    const fileName = `${Date.now()}-${file.name}`\n    const filePath = path.join(uploadDir, fileName)\n    await fs.writeFile(filePath, buffer)\n    \n    const fileUrl = `/uploads/${fileName}`\n\n    const document = await DocumentModel.create({\n      businessId: id,\n      fileName: file.name,\n      fileUrl,\n      documentType,\n    })\n\n    business.documents.push(document._id)\n    await business.save()\n\n    try {\n      const { AuditLog } = await import(\"@/lib/models/AuditLog\")\n      await AuditLog.create({\n        actorId: user.id,\n        action: \"upload_document\",\n        entityType: \"Document\",\n        entityId: document._id,\n        metadata: { businessId: id, documentType },\n      })\n    } catch {}\n\n    return successResponse(document, 201)\n  } catch (error) {\n    console.error(\"Create document error:\", error)\n    return errorResponse(\"Failed to upload document\", 500)\n  }\n}\n"],"names":[],"mappings":"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"}}]
}