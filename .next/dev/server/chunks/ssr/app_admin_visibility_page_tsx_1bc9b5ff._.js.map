{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/priyanshkakkad/Downloads/investment-platform-design/app/admin/visibility/page.tsx"],"sourcesContent":["\"use client\"\n\nimport type React from \"react\"\n\nimport { useEffect, useState } from \"react\"\nimport Link from \"next/link\"\nimport { useRouter } from \"next/navigation\"\n\ninterface VisibilityRecord {\n  _id: string\n  investorId: { _id: string; name: string; email: string }\n  businessId: { _id: string; name: string }\n  createdAt: string\n}\n\ninterface User {\n  _id: string\n  name: string\n  email: string\n}\n\ninterface Business {\n  _id: string\n  name: string\n}\n\nexport default function AdminVisibilityPage() {\n  const router = useRouter()\n  const [visibility, setVisibility] = useState<VisibilityRecord[]>([])\n  const [investors, setInvestors] = useState<User[]>([])\n  const [businesses, setBusinesses] = useState<Business[]>([])\n  const [loading, setLoading] = useState(true)\n  const [selectedInvestor, setSelectedInvestor] = useState(\"\")\n  const [selectedBusiness, setSelectedBusiness] = useState(\"\")\n  const [assigning, setAssigning] = useState(false)\n\n  useEffect(() => {\n    fetchData()\n  }, [])\n\n  const fetchData = async () => {\n    try {\n      const [visRes, usersRes, bizRes] = await Promise.all([\n        fetch(\"/api/admin/visibility\"),\n        fetch(\"/api/admin/users\"),\n        fetch(\"/api/businesses\"),\n      ])\n\n      if (visRes.ok) {\n        const data = await visRes.json()\n        setVisibility(data.data || [])\n      }\n\n      if (usersRes.ok) {\n        const data = await usersRes.json()\n        const investorList = data.data.filter((u: User & { role: string }) => u.role === \"investor\")\n        setInvestors(investorList)\n      }\n\n      if (bizRes.ok) {\n        const data = await bizRes.json()\n        setBusinesses(data.data || [])\n      }\n    } catch (error) {\n      console.error(\"Failed to fetch data:\", error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleAssign = async (e: React.FormEvent) => {\n    e.preventDefault()\n    if (!selectedInvestor || !selectedBusiness) return\n\n    setAssigning(true)\n    try {\n      const response = await fetch(\"/api/admin/visibility\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          investorId: selectedInvestor,\n          businessId: selectedBusiness,\n        }),\n      })\n\n      if (response.ok) {\n        setSelectedInvestor(\"\")\n        setSelectedBusiness(\"\")\n        fetchData()\n      }\n    } catch (error) {\n      console.error(\"Failed to assign visibility:\", error)\n    } finally {\n      setAssigning(false)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white border-b border-gray-200\">\n        <div className=\"max-w-7xl mx-auto px-4 py-4\">\n          <Link href=\"/admin/dashboard\" className=\"text-blue-600 hover:text-blue-700 text-sm mb-2 block\">\n            ‚Üê Back\n          </Link>\n          <h1 className=\"text-2xl font-bold text-gray-900\">Business Visibility Control</h1>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <main className=\"max-w-7xl mx-auto px-4 py-8\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          {/* Assign Form */}\n          <div className=\"lg:col-span-1\">\n            <div className=\"bg-white rounded-lg shadow-sm p-6\">\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Assign Business to Investor</h2>\n              <form onSubmit={handleAssign} className=\"space-y-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Investor</label>\n                  <select\n                    value={selectedInvestor}\n                    onChange={(e) => setSelectedInvestor(e.target.value)}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                  >\n                    <option value=\"\">Select investor...</option>\n                    {investors.map((inv) => (\n                      <option key={inv._id} value={inv._id}>\n                        {inv.name} ({inv.email})\n                      </option>\n                    ))}\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Business</label>\n                  <select\n                    value={selectedBusiness}\n                    onChange={(e) => setSelectedBusiness(e.target.value)}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                  >\n                    <option value=\"\">Select business...</option>\n                    {businesses\n                      .filter((b: Business & { status?: string }) => b.status === \"approved\")\n                      .map((biz) => (\n                        <option key={biz._id} value={biz._id}>\n                          {biz.name}\n                        </option>\n                      ))}\n                  </select>\n                </div>\n\n                <button\n                  type=\"submit\"\n                  disabled={assigning || !selectedInvestor || !selectedBusiness}\n                  className=\"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium py-2 px-4 rounded-lg transition\"\n                >\n                  {assigning ? \"Assigning...\" : \"Assign\"}\n                </button>\n              </form>\n            </div>\n          </div>\n\n          {/* Visibility List */}\n          <div className=\"lg:col-span-2\">\n            <div className=\"bg-white rounded-lg shadow-sm p-6\">\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Current Assignments</h2>\n              {loading ? (\n                <div className=\"text-center py-12\">\n                  <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\n                </div>\n              ) : visibility.length === 0 ? (\n                <p className=\"text-gray-600\">No assignments yet</p>\n              ) : (\n                <div className=\"space-y-3\">\n                  {visibility.map((record) => (\n                    <div\n                      key={record._id}\n                      className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg\"\n                    >\n                      <div>\n                        <p className=\"font-medium text-gray-900\">{record.businessId.name}</p>\n                        <p className=\"text-sm text-gray-600\">{record.investorId.name}</p>\n                      </div>\n                      <span className=\"text-xs text-gray-500\">{new Date(record.createdAt).toLocaleDateString()}</span>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </main>\n    </div>\n  )\n}\n"],"names":[],"mappings":";;;;;AAIA;AACA;AACA;AANA;;;;;AA0Be,SAAS;IACtB,MAAM,SAAS,IAAA,8QAAS;IACxB,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,gVAAQ,EAAqB,EAAE;IACnE,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,gVAAQ,EAAS,EAAE;IACrD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,gVAAQ,EAAa,EAAE;IAC3D,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,gVAAQ,EAAC;IACvC,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,gVAAQ,EAAC;IACzD,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,gVAAQ,EAAC;IACzD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,gVAAQ,EAAC;IAE3C,IAAA,iVAAS,EAAC;QACR;IACF,GAAG,EAAE;IAEL,MAAM,YAAY;QAChB,IAAI;YACF,MAAM,CAAC,QAAQ,UAAU,OAAO,GAAG,MAAM,QAAQ,GAAG,CAAC;gBACnD,MAAM;gBACN,MAAM;gBACN,MAAM;aACP;YAED,IAAI,OAAO,EAAE,EAAE;gBACb,MAAM,OAAO,MAAM,OAAO,IAAI;gBAC9B,cAAc,KAAK,IAAI,IAAI,EAAE;YAC/B;YAEA,IAAI,SAAS,EAAE,EAAE;gBACf,MAAM,OAAO,MAAM,SAAS,IAAI;gBAChC,MAAM,eAAe,KAAK,IAAI,CAAC,MAAM,CAAC,CAAC,IAA+B,EAAE,IAAI,KAAK;gBACjF,aAAa;YACf;YAEA,IAAI,OAAO,EAAE,EAAE;gBACb,MAAM,OAAO,MAAM,OAAO,IAAI;gBAC9B,cAAc,KAAK,IAAI,IAAI,EAAE;YAC/B;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,yBAAyB;QACzC,SAAU;YACR,WAAW;QACb;IACF;IAEA,MAAM,eAAe,OAAO;QAC1B,EAAE,cAAc;QAChB,IAAI,CAAC,oBAAoB,CAAC,kBAAkB;QAE5C,aAAa;QACb,IAAI;YACF,MAAM,WAAW,MAAM,MAAM,yBAAyB;gBACpD,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBACnB,YAAY;oBACZ,YAAY;gBACd;YACF;YAEA,IAAI,SAAS,EAAE,EAAE;gBACf,oBAAoB;gBACpB,oBAAoB;gBACpB;YACF;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,gCAAgC;QAChD,SAAU;YACR,aAAa;QACf;IACF;IAEA,qBACE,6WAAC;QAAI,WAAU;;0BAEb,6WAAC;gBAAO,WAAU;0BAChB,cAAA,6WAAC;oBAAI,WAAU;;sCACb,6WAAC,sSAAI;4BAAC,MAAK;4BAAmB,WAAU;sCAAuD;;;;;;sCAG/F,6WAAC;4BAAG,WAAU;sCAAmC;;;;;;;;;;;;;;;;;0BAKrD,6WAAC;gBAAK,WAAU;0BACd,cAAA,6WAAC;oBAAI,WAAU;;sCAEb,6WAAC;4BAAI,WAAU;sCACb,cAAA,6WAAC;gCAAI,WAAU;;kDACb,6WAAC;wCAAG,WAAU;kDAA2C;;;;;;kDACzD,6WAAC;wCAAK,UAAU;wCAAc,WAAU;;0DACtC,6WAAC;;kEACC,6WAAC;wDAAM,WAAU;kEAA+C;;;;;;kEAChE,6WAAC;wDACC,OAAO;wDACP,UAAU,CAAC,IAAM,oBAAoB,EAAE,MAAM,CAAC,KAAK;wDACnD,WAAU;;0EAEV,6WAAC;gEAAO,OAAM;0EAAG;;;;;;4DAChB,UAAU,GAAG,CAAC,CAAC,oBACd,6WAAC;oEAAqB,OAAO,IAAI,GAAG;;wEACjC,IAAI,IAAI;wEAAC;wEAAG,IAAI,KAAK;wEAAC;;mEADZ,IAAI,GAAG;;;;;;;;;;;;;;;;;0DAO1B,6WAAC;;kEACC,6WAAC;wDAAM,WAAU;kEAA+C;;;;;;kEAChE,6WAAC;wDACC,OAAO;wDACP,UAAU,CAAC,IAAM,oBAAoB,EAAE,MAAM,CAAC,KAAK;wDACnD,WAAU;;0EAEV,6WAAC;gEAAO,OAAM;0EAAG;;;;;;4DAChB,WACE,MAAM,CAAC,CAAC,IAAsC,EAAE,MAAM,KAAK,YAC3D,GAAG,CAAC,CAAC,oBACJ,6WAAC;oEAAqB,OAAO,IAAI,GAAG;8EACjC,IAAI,IAAI;mEADE,IAAI,GAAG;;;;;;;;;;;;;;;;;0DAO5B,6WAAC;gDACC,MAAK;gDACL,UAAU,aAAa,CAAC,oBAAoB,CAAC;gDAC7C,WAAU;0DAET,YAAY,iBAAiB;;;;;;;;;;;;;;;;;;;;;;;sCAOtC,6WAAC;4BAAI,WAAU;sCACb,cAAA,6WAAC;gCAAI,WAAU;;kDACb,6WAAC;wCAAG,WAAU;kDAA2C;;;;;;oCACxD,wBACC,6WAAC;wCAAI,WAAU;kDACb,cAAA,6WAAC;4CAAI,WAAU;;;;;;;;;;+CAEf,WAAW,MAAM,KAAK,kBACxB,6WAAC;wCAAE,WAAU;kDAAgB;;;;;6DAE7B,6WAAC;wCAAI,WAAU;kDACZ,WAAW,GAAG,CAAC,CAAC,uBACf,6WAAC;gDAEC,WAAU;;kEAEV,6WAAC;;0EACC,6WAAC;gEAAE,WAAU;0EAA6B,OAAO,UAAU,CAAC,IAAI;;;;;;0EAChE,6WAAC;gEAAE,WAAU;0EAAyB,OAAO,UAAU,CAAC,IAAI;;;;;;;;;;;;kEAE9D,6WAAC;wDAAK,WAAU;kEAAyB,IAAI,KAAK,OAAO,SAAS,EAAE,kBAAkB;;;;;;;+CAPjF,OAAO,GAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkBrC"}}]
}